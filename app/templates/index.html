{% extends 'base.html' %}

{% block title %}Telefoonboek{% endblock %}

{% block content %}
<h1 class="text-2xl font-bold mb-4">Contacten</h1>
<div class="space-x-2">
  <a class="bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600" href="{{ url_for('main.add') }}">Nieuwe contact</a>
  <a class="bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600" href="{{ url_for('main.import_view') }}">Importeer CSV</a>
</div>
<ul class="mt-4 space-y-2">
  {% for c in contacts %}
  <li id="contact-{{ loop.index0 }}" class="flex justify-between items-center bg-white p-2 rounded shadow">
    <span>{{ c.name }} - {{ c.telephone }}{% if c.label %} ({{ c.label }}){% endif %}</span>
    <div>
      <a class="text-blue-500 hover:underline mr-2" href="{{ url_for('main.edit', index=loop.index0) }}">Bewerk</a>
      <form class="inline delete-form" action="{{ url_for('main.delete', index=loop.index0) }}" method="post">
          <button class="text-red-600 hover:underline" type="submit">Verwijder</button>
      </form>
    </div>
  </li>
  {% endfor %}
</ul>
<script>
document.querySelectorAll('.delete-form').forEach(form => {
  form.addEventListener('submit', async ev => {
    ev.preventDefault();
    if (!confirm('Weet je zeker dat je deze wilt verwijderen?')) return;
    const resp = await fetch(form.action, {method: 'DELETE'});
    if (resp.ok) {
      form.closest('li').remove();
    }
  });
});
</script>
{% endblock %}
